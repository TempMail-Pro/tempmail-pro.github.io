<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TempMail Pro - Free Temporary Email</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <style>
    body.dark-mode {
      background-color: #121212;
      color: #ffffff;
    }
    .email-box {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .qr-code {
      margin-top: 15px;
    }
  </style>
</head>
<body class="p-4">

  <div class="d-flex justify-content-between align-items-center">
    <h1>ðŸ“§ TempMail Pro</h1>
    <button onclick="toggleDarkMode()" class="btn btn-outline-secondary">ðŸŒ“ Toggle Dark Mode</button>
  </div>

  <hr>

  <!-- Temp Email Section -->
  <div class="email-box my-3">
    <input type="text" id="emailAddress" class="form-control" readonly />
    <button onclick="copyEmail()" class="btn btn-primary">ðŸ“‹ Copy</button>
    <button onclick="generateQRCode()" class="btn btn-info">ðŸ”³ QR</button>
  </div>

  <div id="qrContainer" class="qr-code"></div>

  <!-- Inbox Section -->
  <h4>ðŸ“¥ Inbox</h4>
  <div id="loader" class="text-muted">Loading inbox...</div>
  <ul id="inboxList" class="list-group"></ul>

  <audio id="notifSound" src="https://notificationsounds.com/storage/sounds/file-sounds-1162-pristine.mp3"></audio>

  <!-- Scripts -->
  <script>
    const domain = "1secmail.com";
    let emailName = "";
    let prevMessageIds = [];

    function generateRandomEmail() {
      emailName = "tempmail_" + Math.floor(Math.random() * 100000);
      const email = `${emailName}@${domain}`;
      document.getElementById("emailAddress").value = email;
    }

    function copyEmail() {
      const input = document.getElementById("emailAddress");
      input.select();
      document.execCommand("copy");
      alert("Copied to clipboard!");
    }

    function generateQRCode() {
      const email = document.getElementById("emailAddress").value;
      QRCode.toCanvas(email, { width: 150 }, (err, canvas) => {
        const container = document.getElementById("qrContainer");
        container.innerHTML = ""; // clear previous
        container.appendChild(canvas);
      });
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }

    async function fetchInbox() {
      const url = `https://www.1secmail.com/api/v1/?action=getMessages&login=${emailName}&domain=${domain}`;
      const res = await fetch(url);
      const data = await res.json();

      const inboxList = document.getElementById("inboxList");
      inboxList.innerHTML = ""; // Clear inbox
      document.getElementById("loader").style.display = data.length ? "none" : "block";

      const newIds = data.map(msg => msg.id);
      const hasNew = newIds.some(id => !prevMessageIds.includes(id));
      if (hasNew && prevMessageIds.length) {
        document.getElementById("notifSound").play();
      }
      prevMessageIds = newIds;

      data.forEach(msg => {
        const li = document.createElement("li");
        li.className = "list-group-item";
        li.innerHTML = `<strong>${msg.from}</strong>: ${msg.subject}`;
        li.onclick = () => viewEmail(msg.id);
        inboxList.appendChild(li);
      });
    }

    async function viewEmail(id) {
      const url = `https://www.1secmail.com/api/v1/?action=readMessage&login=${emailName}&domain=${domain}&id=${id}`;
      const res = await fetch(url);
      const data = await res.json();
      alert(`From: ${data.from}\nSubject: ${data.subject}\n\n${data.textBody || data.body}`);
    }

    function startAutoRefresh() {
      fetchInbox();
      setInterval(fetchInbox, 10000); // every 10 seconds
    }

    // Init
    generateRandomEmail();
    startAutoRefresh();
  </script>
</body>
</html>
